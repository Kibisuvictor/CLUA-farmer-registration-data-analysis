---
title: "CLUA_AP DATA ANALYSIS"
author: "Eva Wanjiru"
date: "`r Sys.Date()`"
output: html_document
---

```{r load packages}
library(tidyverse)
library(summarytools)
library(ggplot2)
library(scales)
library(ggeasy)
library(tidytext)
```

```{r load data}
#load the two datasets to be used for analysis
CLUA_reg<-read.csv("CLUA_AP_farmer_registration_form.csv")
CLUA_farm<-read.csv("CLUA_AP_farmer_registration_form-farm_details.csv")

##rename column key
CLUA_reg <- CLUA_reg %>%
  rename_at("KEY", ~"PARENT_KEY")

#merge the two datasets using the parent key
CLUA_df<-merge(CLUA_reg,CLUA_farm,by="PARENT_KEY")

```

```{r}
##Subset the dataset to be used
df_sub<-CLUA_df[,1:63]

#check the names
names(df_sub)
#look at the first 6 rows
head(df_sub)

##check for missing values
colSums(is.na(df_sub))
```

```{r district}
freq(df_sub$District)

##rename the Districts
df_sub$District[df_sub$District=="1"]<-"Anantapuramu"
df_sub$District[df_sub$District=="2"]<-"Visakhapatnam"
df_sub$District[df_sub$District=="3"]<- "West Godavari"

#Barplot of Districts
df_sub %>% 
  ggplot(aes(District))+
  geom_bar(fill="darkgreen")+
  ggtitle("Barplot of the districts under study")+
  ggeasy::easy_center_title()+
  coord_flip()
```

Anantapuramu is the district with the highest count of participants accounting for 46.33% while Visakhapatnam has the least count of participants and accounts for 24.32%.

```{r village}
freq(df_sub$village)
#rename the villages
df_sub$village[df_sub$village=="D Gondhuru"]<-"D.Gondhuru"
df_sub$village[df_sub$village=="D.Gondhru"]<-"D.Gondhuru"
df_sub$village[df_sub$village=="D.Gondhuru"]<-"D.Gondhuru"
df_sub$village[df_sub$village=="Korakodu"]<-"Korrakodu"

#visualize
df_sub %>% 
  ggplot(aes(village))+
  geom_bar(fill="darkgreen")+
  ggtitle("Barplot of the villages under study")+
  ggeasy::easy_center_title()+
  coord_flip()
```
Jayapuram is the village that had the highest count of farms under this study and accounts for 25.58%

```{r latitude}
summary(df_sub$gps.Latitude)
```
```{r Longitude}
summary(df_sub$gps.Longitude)
```
```{r Altitude}
summary(df_sub$gps.Altitude)
```

```{r accuracy}
summary(df_sub$gps.Accuracy)
boxplot.stats(df_sub$gps.Accuracy)$out
```

There are outliers of the gps accuracy and hence further investigation needs to be done.

```{r}
ggplot(df_sub)+geom_point(aes(x=gps.Latitude, y=gps.Longitude,colour=District))+
  xlab("village_latitude")+
  ylab("village_longitude")+
  ggtitle("Latitudes and longitudes of the villages in different Districts")
```

```{r gender}
df_sub$farmer_details.farmer_gender<-as.factor(df_sub$farmer_details.farmer_gender)
levels(df_sub$farmer_details.farmer_gender)<-c("female","male")
freq(df_sub$farmer_details.farmer_gender)

df_sub %>% 
  ggplot(aes(farmer_details.farmer_gender)) +
      geom_bar(fill = "blue", aes(y = (..count..)/sum(..count..)))+
  geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust = 1.5, colour = "white")+
  scale_y_continuous(labels =percent) +
   ggtitle("Barplot of the different genders in the study")+
  ggeasy::easy_center_title()+
  ylab("Percentage")+
  xlab("Gender")
```

Most of the farmers are males and account for 77.57% of the total population under study.

```{r age}
summary(df_sub$farmer_details.farmer_age)

##create age categories
labs <- c("below 15","15-24","25-34","35-44","45-54","54-64","65+")

#create a new variable for the age groups
df_sub$AgeGroup <- cut(df_sub$farmer_details.farmer_age,breaks=c(0,15,25,35,45,54,65,Inf),labels = labs)
freq(df_sub$AgeGroup)

##visualize the age groups
ggplot(df_sub,aes(AgeGroup))+
  geom_bar(fill="darkolivegreen")+
  ggtitle("Barplot of the Age Groups")+
  ggeasy::easy_center_title()+
  coord_flip()
```

The median age for farmers is 45 but age categories are created to analyse where most farmers lie.Most farmers are aged between 35 and 44 and account for 29.14% of the total population while those aged between 15-24 and above 65 are the minority group and account for 2.94% and 3.14% respectively.

```{r marital status}
df_sub$farmer_details.marital_status<-as.factor(df_sub$farmer_details.marital_status)
levels(df_sub$farmer_details.marital_status)<-c("Single","Married","Widowed")
freq(df_sub$farmer_details.marital_status)

##analysis of the marital statuses
df_sub %>% 
  ggplot(aes(farmer_details.marital_status)) +
      geom_bar(fill = "skyblue", aes(y = (..count..)/sum(..count..)))+
  geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust = 0.5, colour = "red")+
  scale_y_continuous(labels =percent) +
   ggtitle("Barplot of the different marital statuses in the study")+
  ggeasy::easy_center_title()+
  ylab("Percentage")+
  xlab("Marital status")

##marital analysis according to the different genders
df_sub %>% 
  ggplot(aes(farmer_details.marital_status,farmer_details.farmer_gender,fill=farmer_details.farmer_gender)) +
      geom_col(position = "dodge")+
   ggtitle("Barplot of the different marital statuses according to different genders")+
  ggeasy::easy_center_title()+
  ylab("Percentage")+
  xlab("Marital status")+
  theme(plot.title = element_text(size=11))
```

In this study, most of the participants are married and an analysis according to gender is done and the results are shown in the barplot above.

```{r mainincomesource}
freq(df_sub$hh_income.main_income_source)
##recode the sources 
df_sub$hh_income.main_income_source[df_sub$hh_income.main_income_source=="1"]<-"Agriculture - from own farm"
df_sub$hh_income.main_income_source[df_sub$hh_income.main_income_source=="2"]<-"Remittance from relatives"
df_sub$hh_income.main_income_source[df_sub$hh_income.main_income_source=="3"]<-"Formal employment"
df_sub$hh_income.main_income_source[df_sub$hh_income.main_income_source=="4"]<-"Casual employment"
df_sub$hh_income.main_income_source[df_sub$hh_income.main_income_source=="7"]<-"Other"

##visualization
df_sub %>%
  ggplot(aes(hh_income.main_income_source))+
        geom_bar(fill = "skyblue", aes(y = (..count..)/sum(..count..)))+
  geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust =0.00345, colour = "red")+
  scale_y_continuous(labels =percent) +
   ggtitle("Barplot of the main income sources")+
  ggeasy::easy_center_title()+
  ylab("Percentage")+
  xlab("Main income source")+
  coord_flip()
```

The main source according to most farmers in this study is Agriculture from their own farm which accounts for 96.23%.

```{r incomeaccordingtoDistrict} 
df_sub %>% 
  ggplot(aes(hh_income.main_income_source,fill=District))+
  geom_bar(position = "dodge")+
  ggtitle("Barplot of main income sources according to districts")+
  ggeasy::easy_center_title()+
  xlab("Main_income source")+
  coord_flip()
```

```{r mainincomeother}
freq(df_sub$hh_income.main_income_other)
```

**FUNCTION FOR SPLITTING MESSY COLUMNS**
```{r}
###SPLITTING THE MESSY COLUMNS####
##Set the standard function for splitting the columns####
#use the function below to separate the strings 
split_into_multiple <- function(column, pattern = ",", into_prefix){
  cols <- str_split_fixed(column, pattern, n = Inf)
  # Sub out the ""'s returned by filling the matrix to the right, with NAs which are useful
  cols[which(cols == "")] <- NA
  cols <- as.tibble(cols)
  # name the 'cols' tibble as 'into_prefix_1', 'into_prefix_2', ..., 'into_prefix_m' 
  # where m = # columns of 'cols'
  m <- dim(cols)[2]

  names(cols) <- paste(into_prefix, 1:m, sep = "_")
  return(cols)
}
```


```{r agricproduce}
##split and gather the columns
df1<-df_sub%>% 
  bind_cols(split_into_multiple(.$hh_income.agricultural_produce," ","agricultural_produce"))
Agric_produce<-df1%>%select(c(agricultural_produce_1,agricultural_produce_2,agricultural_produce_3,agricultural_produce_4)) %>% gather(agricultural_produce,type)
#3get the frequency
freq(Agric_produce$type)

##barplot
Agric_produce %>%drop_na(type) %>% 
  ggplot(aes(factor(fct_infreq(type))))+
  geom_bar(fill="skyblue",aes(y=(..count..)/sum(..count..)))+
   geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust =0.5, colour = "red")+
  ylab("percentage")+
  xlab("Produce")+
  scale_y_continuous(labels=percent)+
  ggtitle("Barplot of income from agricultural produce")
```

Most farmers(49.21%) produce vegetables in their farms for cash income and the least group(0.63%) produce firewood.

```{r}

##recode the levels
df1$hh_income.secondary_income_source[df1$hh_income.secondary_income_source=="1"]<-"Agriculture - from own farm"
df1$hh_income.secondary_income_source[df1$hh_income.secondary_income_source=="2"]<-"Remittance from relatives"
df1$hh_income.secondary_income_source[df1$hh_income.secondary_income_source=="3"]<-"Formal employment"
df1$hh_income.secondary_income_source[df1$hh_income.secondary_income_source=="4"]<-"Casual employment"
df1$hh_income.secondary_income_source[df1$hh_income.secondary_income_source=="5"]<-"Business enterprise"
df1$hh_income.secondary_income_source[df1$hh_income.secondary_income_source=="6"]<-"None"
df1$hh_income.secondary_income_source[df1$hh_income.secondary_income_source=="7"]<-"Other"

#get the frequency 
df1 %>%
  ggplot(aes(hh_income.secondary_income_source))+
  geom_bar(fill="skyblue",aes(y=(..count..)/sum(..count..)))+
   geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust =0.5, colour = "red")+
  ylab("percentage")+
  xlab("Secondary source of income")+
  scale_y_continuous(labels=percent)+
  coord_flip()+
  ggtitle("Barplot of secondary income source")
```

From the graph above, it can be seen that most of the secondary income is from Agriculture in the farmer's own farms



```{r}
freq(df1$hh_income.secondary_income_other)
```

```{r educationlevel}
df1$group_house.education_level<-as.factor(df1$group_house.education_level)
levels(df1$group_house.education_level)<-c("No formal schooling","Primary","Secondary","Tertiary","Other")
freq(df1$group_house.education_level)

df1 %>% drop_na(group_house.education_level) %>% 
  ggplot(aes(factor(fct_infreq(group_house.education_level))))+
  geom_bar(fill="darkgreen",aes(y=((..count..)/sum(..count..))))+
   geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust =0.5, colour = "white")+
  ylab("percentage")+
  scale_y_continuous(labels=percent)+
  ggtitle("Barplot of education level")+
  xlab("Education level")

```

From the output above,most farmers have secondary level information. 

```{r hhpopulation}
summary(df1$group_house.hh_pop)
boxplot.stats(df1$group_house.hh_pop)$out

##boxplot
meanFunction <- function(x){
return(data.frame(y=round(mean(x),2),label=round(mean(x,na.rm=T),2)))}

df1 %>% drop_na(group_house.hh_pop) %>% 
  ggplot(aes(x="",y=group_house.hh_pop))+
  geom_boxplot(fill="darkgreen")+
  stat_summary(fun.y = mean, geom="point",colour="darkred", size=4) +
stat_summary(fun.data = meanFunction, geom="text", size = 4, vjust=1.3) +
  ggtitle("Boxplot of household sizes")+
  xlab("")+
  ylab("hh size")+
  ggeasy::easy_center_title()
```
The summary statistics for the household population are given and there are some outliers that is families having a population above 8 members. The boxplot is however shown for easy visualization and it can be seen that the average number of members in a household is 4 members.

```{r numofchildren}
freq(df1$group_house.num_child)
df1$group_house.num_child<-as.character(df1$group_house.num_child)


df1 %>% ggplot(aes(group_house.num_child))+
  geom_bar(fill="darkgreen",aes(y=((..count..)/sum(..count..))))+
   geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust =0.5, colour = "white")+
  ylab("percentage")+
  xlab("number_of_children")+
  scale_y_continuous(labels=percent)+
  ggtitle("Barplot of number of children")
```

In this study,most families had 2 children accounting for 39.83% of the total population and 32.70% for families with no children while the least 0.21% accounts for families with 6 children.

```{r activeinthe farm}
##How many of the household members are active on the farm?
df1$group_house.active_farm<-as.character(df1$group_house.active_farm)
freq(df1$group_house.active_farm)


df1 %>% ggplot(aes(group_house.active_farm))+
  geom_bar(fill="darkgreen",aes(y=((..count..)/sum(..count..))))+
   geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust =0.5, colour = "white")+
  ylab("percentage")+
  xlab("number_of_active_farmhh")+
  scale_y_continuous(labels=percent)+
  ggtitle("Barplot of number of active farm hh members")
```

Most families have 2 household members who are active on the farm.

```{r}
df1$num_farms<-as.character(df1$num_farms)
freq(df1$num_farms)

df1 %>% drop_na(num_farms) %>% 
  ggplot(aes(num_farms))+
  geom_bar(fill="darkgreen",aes(y=((..count..)/sum(..count..))))+
   geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust =0.5, colour = "white")+
  ylab("percentage")+
  xlab("number_of_farms")+
  scale_y_continuous(labels=percent)+
  ggtitle("Barplot of number of hh farms")
```

```{r treeson farm}
df1$group_tree.trees_onfarm<-as.factor(df1$group_tree.trees_onfarm)
freq(df1$group_tree.trees_onfarm)
levels(df1$group_tree.trees_onfarm)<-c("no","yes")

df1 %>% ggplot(aes(group_tree.trees_onfarm))+
  geom_bar()+
  ggtitle("Barplot of whether there are trees on farm or not")+
  xlab("trees on farm")
```

The larger percentage 61.64% of the farmers during this period of study had trees on their farms.

```{r treespecies}
###Which tree species do  you have on your farm?
df2<-df1%>% 
  bind_cols(split_into_multiple(.$group_tree.tree_species," ","tree_species"))
Tree_species<-df2 %>% select(tree_species_1,tree_species_2,tree_species_3,tree_species_4,tree_species_5) %>% 
  gather(tree_species,type)
#reorder the levels
Tree_species$type<-as.factor(Tree_species$type)
levels(Tree_species$type)<-c("Mangifera indica (mango)","Cocos nucifera (coconut)","Grevillea robusta (silver oak)","Other","Annona reticulata (Custard apple)","Psidium guajava (Guava)","Tamarindus indica (Tamarind)","Carica papaya (Papaya)","Citrus Limon (Lemon)")
freq(Tree_species$type)

Tree_species %>% drop_na(type) %>% 
  ggplot(aes(factor(fct_infreq(type))))+
   geom_bar(fill="skyblue",aes(y=(..count..)/sum(..count..)))+
   geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust =0.5, colour = "red")+
  coord_flip()+
  scale_y_continuous(labels = percent)+
  ylab("percentage")+
  xlab("Species")
```

Coconut is the most prevalent tree species and accounts for 38.03% of the total trees available.

```{r}
##What other tree species do you have on your farm
##split the column
df3<-df2%>% 
  bind_cols(split_into_multiple(.$group_tree.tree_species_other," ","other_tree_species"))
Other_species<-df3 %>% select(other_tree_species_1,other_tree_species_2) %>% 
  gather(other_tree_species,type)
##change into factor and rename the levels
Other_species$type<-factor(Other_species$type)
levels(Other_species$type)
levels(Other_species$type)<-c("Banana","Coconut","Grapes","Grapes","Orange","Orange","Pomegranate","Pomegranate","Pomegranate","Pomegranate","Sapota")
#3check the frequency
freq(Other_species$type)

##barplot
Other_species %>% drop_na(type) %>% 
  ggplot(aes(factor(fct_infreq(type))))+
  geom_bar(fill="darkgreen",aes(y=(..count..)/sum(..count..)))+
    geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust =0.5, colour = "white")+
  scale_y_continuous(labels = percent)+
  ylab("percentage")+
  xlab("Species")+
  ggtitle("Barplot of other tree species")+
  ggeasy::easy_center_title()
```

```{r unavailabletree}
##Is there  a tree(s) that has disappeared in your farm which was there before?
df3$group_tree.unavailable_tree<-as.factor(df3$group_tree.unavailable_tree)
levels(df3$group_tree.unavailable_tree)<-c("no","yes")
freq(df3$group_tree.unavailable_tree)

##barplot
df3 %>% drop_na(group_tree.unavailable_tree) %>% 
  ggplot(aes(group_tree.unavailable_tree))+
  geom_bar()+
  ggtitle("Barplot of unavailable trees")+
  xlab("unavailable tree")+
  ggeasy::easy_center_title()
```

The larger percentage(97.96%) of the farmers during this period of study did not have trees that disappeared from their farms that were there before.

```{r unavailabletreetype}
freq(df3$group_tree.unavailable_tree_type)
```

```{r}
###What products do you currently obtain from the trees grown on your farm?
df4<-df3%>% 
  bind_cols(split_into_multiple(.$group_tree.tree_products," ","tree_products"))
Tree_products<-df4 %>% select(tree_products_1,tree_products_2,tree_products_3,tree_products_4) %>% 
  gather(tree_products,type)

##change into a factor variable
Tree_products$type<-as.factor(Tree_products$type)
levels(Tree_products$type)<-c("Timber","Firewood","Fruits","Other")
freq(Tree_products$type)

##visualize
Tree_products %>% drop_na(type) %>% 
  ggplot(aes(factor(fct_infreq(type))))+
  geom_bar(fill="purple",aes(y=(..count..)/sum(..count..)))+
  geom_text(aes(y=((..count..)/sum(..count..)),label=scales::percent((..count..)/sum(..count..))),stat = "count",vjust=0.5,colour="black")+
  scale_y_continuous(labels=percent)+
  ylab("percentage")+
  xlab("Type")+
  ggtitle("Barplot of tree products obtained")+
  ggeasy::easy_center_title()
```

```{r useoftreeproducts}
df4$group_tree.tree_product_use<-factor(df4$group_tree.tree_product_use)
levels(df4$group_tree.tree_product_use)<-c("Own consumption","Sale","Both")

freq(df4$group_tree.tree_product_use)

##visualization
df4 %>% drop_na(group_tree.tree_product_use) %>% 
  ggplot(aes(factor(fct_infreq(group_tree.tree_product_use))))+
  geom_bar(fill="skyblue",aes(y=(..count..)/sum(..count..)))+
  geom_text(aes(y=((..count..)/sum(..count..)),label=scales::percent((..count..)/sum(..count..))),stat = "count",vjust=0.5,colour="black")+
  scale_y_continuous(labels=percent)+
  ylab("percentage")+
  xlab("use")+
  ggtitle("Barplot of use of tree products")+
  ggeasy::easy_center_title()
```

60% of the farmers use the tree products for both own consumption and sale and the least percentage(3%) uses tree products for sale.

```{r}
##How else do you use the trees on your farm?
#trigram
df4<-df4 %>% drop_na(group_tree.tree_use)
trigrams_separated_uncommon <- df4 %>% 
   select(group_tree.tree_use) %>% 
  unnest_tokens(trigram, group_tree.tree_use, token = "ngrams", n = 2) %>% 
   separate(trigram, c("word1", "word2","word3"), sep = " ") %>%
  filter(!word1 %in% stop_words$word,
         !word2 %in% stop_words$word) %>%
  count(word1, word2, sort = TRUE)

### unite the trigrams
trigrams_united_uncommon <- trigrams_separated_uncommon %>%
  unite(trigram, word1, word2, sep = " ")
trigrams_united_uncommon %>% View()
```

There is not much found out about how trees are used but it can be observed that they are used for housing purposes and as wind breakers.

```{r livestockkeeping}
##Do you keep livestock?
df4$group_livestock.livestock_keeping<-factor(df4$group_livestock.livestock_keeping)
levels(df4$group_livestock.livestock_keeping)<-c("no","yes")
freq(df4$group_livestock.livestock_keeping)

##visualize
df4 %>% ggplot(aes(group_livestock.livestock_keeping))+
  geom_bar()+
  xlab("livestock keeping")+
  ggtitle("Barplot of whether they keep livestock or not")
```

The larger percentage of farmers(74.09%) keeps livestock in their farms.

```{r livestock type}
##check the frequency
##freq(df4$group_livestock.livestock_type)

df5<-df4 %>% 
  bind_cols(split_into_multiple(.$group_livestock.livestock_type," ","livestock_type"))

Livestock_Type<-df5 %>% select(livestock_type_1,livestock_type_2,livestock_type_3,livestock_type_4) %>% 
  gather(livestock_type,type)


#investigate the individual livestock types
Livestock_Type$type<-factor(Livestock_Type$type)
levels(Livestock_Type$type)<-c("Cows","Buffaloes","Goats","Sheep","Oxen","Poultry")
##check the frequency
freq(Livestock_Type$type)

##visualize
Livestock_Type %>% drop_na(type) %>% 
  ggplot(aes(fct_infreq(type)))+
  geom_bar(fill="brown",aes(y=(..count..)/sum(..count..)))+
    geom_text(aes(y=((..count..)/sum(..count..)),label=scales::percent((..count..)/sum(..count..))),stat = "count",vjust=0.5,colour="white")+
  scale_y_continuous(labels=percent)+
  ylab("percentage")+
  xlab("Type of livestock")+
  ggtitle("Barplot of use of types of livestock")+
  ggeasy::easy_center_title()

```

The highest percentage(35.5%) of the farmers keep cows and the least percentage (1.2%) rears sheep.

```{r livestock products}
###What products do you currently obtain from the livestock kept on your farm?
freq(df5$group_livestock.livestock_products)
df6<-df5 %>% 
  bind_cols(split_into_multiple(.$group_livestock.livestock_products,"","livestock_products"))

##gather the split columns
Livestock_products<-df6 %>% 
  select(livestock_products_1,livestock_products_2,livestock_products_3,livestock_products_4,livestock_products_5,livestock_products_6,livestock_products_7) %>% 
  gather(livestock_products,type)

##check for the frequency
freq(Livestock_products$type)
#convert into factor
Livestock_products$type<-factor(Livestock_products$type)

##rename
levels(Livestock_products$type)<-c("","Meat","Milk","Eggs","Manure","Other")

##barplot
Livestock_products %>% filter(type %in% c("Meat","Milk","Eggs","Manure","Other")) %>% 
  ggplot(aes(fct_infreq(type)))+
  geom_bar(fill="darkgreen",aes(y=(..count..)/sum(..count..)))+
 geom_text(aes(y=((..count..)/sum(..count..)),label=scales::percent((..count..)/sum(..count..))),stat = "count",vjust=0.5,colour="white")+  scale_y_continuous(labels = percent)+
  ylab("percentage")+
  xlab("Livestock product")+
  ggtitle("Barplot of the different livestock products")+
  ggeasy::easy_center_title()
```
 
The highest percentage of farmers mainly obtain manure from the livestock kept in the farm and this accounts for 39.6% of the total livestock products.

```{r otherlivestockproducts}
df6$group_livestock.livestock_products_other<-as.factor(df6$group_livestock.livestock_products_other)
levels(df6$group_livestock.livestock_products_other)<-c("","ploughing","chicken","eggs,meat,ploughing","ploughing")
freq(df6$group_livestock.livestock_products_other)

# df7 <-df6 %>% 
#   bind_cols(split_into_multiple(.$group_livestock.livestock_products_other," ","other_livestock_products"))
# 
# ##gather
# Other_livestock_products<-df7 %>% select(other_livestock_products_1) %>% 
#   gather(Other_livestock_products,type)
# freq(Other_livestock_products$type)
```

```{r livestockproductuse}
##Are these products for home consumption or for sale?
df6$group_livestock.livestock_products_use<-factor(df6$group_livestock.livestock_products_use)
levels(df6$group_livestock.livestock_products_use)<-c("own consumption","both")
freq(df6$group_livestock.livestock_products_use)

##barplot
df6 %>% drop_na(group_livestock.livestock_products_use) %>% 
  ggplot(aes(group_livestock.livestock_products_use))+
  geom_bar(fill="darkgreen",aes(y=(..count..)/sum(..count..)))+
    geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust =0.5, colour = "white")+
  scale_y_continuous(labels = percent)+
  ylab("percentage")+
  xlab("Species")+
  ggtitle("Barplot of use of livestock products")+
  ggeasy::easy_center_title()
```

55.94% of farmers which is the higher percentage use livestock products for their own consumption and 44.06% use it for both own consumption and sale.

```{r distancetoroad}
##What is the distance from your farm to nearest main road?
summary(df6$group_distance.distance_road)
#check for outliers
boxplot.stats(df6$group_distance.distance_road)$out
```

There are outliers in the distance from the farm to the nearest main road.

```{r distancetomarket}
summary(df6$group_distance.distance_market)
#check for outliers
boxplot.stats(df6$group_distance.distance_market)$out
```
There are outliers in the distance to the market.

```{r climatechange}
##Have you heard of climate change?
df6$group_climatechange.climate_change<-factor(df6$group_climatechange.climate_change)
levels(df6$group_climatechange.climate_change)<-c("no","yes")
freq(df6$group_climatechange.climate_change)

##visualize
df6 %>% 
  ggplot(aes(group_climatechange.climate_change))+
  geom_bar(fill="darkgreen",aes(y=(..count..)/sum(..count..)))+
    geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust =0.5, colour = "white")+
  scale_y_continuous(labels = percent)+
  ylab("percentage")+
  xlab("Climate change")+
  ggtitle("Barplot of climate change")+
  ggeasy::easy_center_title()
```

79% of farmers in this study have heard avout climate change.

```{r climatechangeaspects}
###What aspects of climate change have you heard of?
##split the column for further analysis.
df7<-df6 %>% 
  bind_cols(split_into_multiple(.$group_climatechange.cc_aspects," ","climate_changeaspects"))
##gather the columns
Climate_change_aspects<-df7 %>% select(climate_changeaspects_1,climate_changeaspects_2,climate_changeaspects_3,climate_changeaspects_4,climate_changeaspects_5,climate_changeaspects_6) %>% 
  gather(Climate_change_aspects,type)
##check the frequency
freq(Climate_change_aspects$type)

##convert into factor
Climate_change_aspects$type<-factor(Climate_change_aspects$type)
levels(Climate_change_aspects$type)<-c("Rising temperatures","Drought","Floods","Erratic rainfall","Low rainfall","Strong winds","Other")

##frequency
freq(Climate_change_aspects$type)

##barplot
 Climate_change_aspects%>% drop_na(type) %>% 
  ggplot(aes(type))+
  geom_bar(fill="darkgreen",aes(y=(..count..)/sum(..count..)))+
    geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust =0.5, colour = "white")+
  scale_y_continuous(labels = percent)+
  ylab("percentage")+
  xlab("Climate change aspects")+
  ggtitle("Barplot of climate change aspects")+
  ggeasy::easy_center_title()
```

Most farmers 30.13% of the total number of farmers interviewed noted that they have mostly heard of floods followed by drought(21.94%).

```{r climatechangeexperience}
##convert into factor with levels
df7$group_climatechange.cc_experience<-factor(df7$group_climatechange.cc_experience)
levels(df7$group_climatechange.cc_experience)<-c("no","yes")
freq(df7$group_climatechange.cc_experience)

##visualization
df7 %>%  drop_na(group_climatechange.cc_experience) %>% 
  ggplot(aes(group_climatechange.cc_experience))+
  geom_bar(fill="brown",aes(y=(..count..)/sum(..count..)))+
    geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust =0.5, colour = "black")+
  scale_y_continuous(labels = percent)+
  ylab("percentage")+
  xlab("Climate change ")+
  ggtitle("Barplot of whether climate change was experienced")+
  ggeasy::easy_center_title()
```

96% of the farmers noted that they experienced climate change and the next code chunk investigates the different types of climate cjhange aspects that were experienced.

```{r climatechangeaspectsexperienced}
##check the frequency
freq(df7$group_climatechange.cchange_experience)
##split the column
df8<-df7 %>% 
  bind_cols(split_into_multiple(.$group_climatechange.cchange_experience," ", "Climate_experience"))
##gather the columns
Climate_aspects_experienced<-df8 %>% 
  select(Climate_experience_1,Climate_experience_2,Climate_experience_3,Climate_experience_4) %>% 
  gather(Climate_experience,type)

##convert to factor
Climate_aspects_experienced$type<-factor(Climate_aspects_experienced$type)
levels(Climate_aspects_experienced$type)<-c("Erratic rainfall","Low rainfall","Flooding due to heavy rainfall","Prolonged drought","Increasing temperatures","Other")
##frequency
freq(Climate_aspects_experienced$type)

##visualize
 Climate_aspects_experienced%>% drop_na(type) %>% 
  ggplot(aes(type))+
  geom_bar(fill="firebrick",aes(y=(..count..)/sum(..count..)))+
    geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust =0.5, colour = "black")+
  scale_y_continuous(labels = percent)+
  ylab("percentage")+
  xlab("Climate change aspects")+
  ggtitle("Barplot of climate change aspects experienced")+
  ggeasy::easy_center_title()
```

The highest percentage of farmers have experienced floods which accounts for 36.57% of the total climate aspects experienced and the least percentage 0.28% accounts for those that have experienced other climate change aspects.

```{r}
freq(df8$group_climatechange.cc_impact)
##split the column
df9<-df8 %>% 
  bind_cols(split_into_multiple(.$group_climatechange.cc_impact," ", "Climate_impact"))
##gather the columns
Climate_impact<-df9 %>% 
  select(Climate_impact_1,Climate_impact_2,Climate_impact_3,Climate_impact_4,Climate_impact_5,Climate_impact_6) %>% 
  gather(Climate_impact,type)

##recode the columns
Climate_impact$type<-factor(Climate_impact$type)
levels(Climate_impact$type)<-c("Reduced crop yield","Change in planting time","Crop failure","Increased pests and diseases infestation","Flooding of crop fields","Reduced soil moisture","other")
##frequency
freq(Climate_impact$type)

##visualize
 Climate_impact%>% drop_na(type) %>% 
  ggplot(aes(type))+
  geom_bar(fill="firebrick",aes(y=(..count..)/sum(..count..)))+
    geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust =0.5, colour = "black")+
  scale_y_continuous(labels = percent)+
  ylab("percentage")+
  xlab("Climate change impact")+
  ggtitle("Barplot of climate change impact")+
  ggeasy::easy_center_title()+
   coord_flip()
```

The most prevalent impact of climate change is reduced crop yield which accounts for 22.61% of the total impacts and is closely followed by flooding of crop fields which accounts for 22.27%.